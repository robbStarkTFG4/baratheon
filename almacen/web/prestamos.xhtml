<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>

        <title>historial prestamos</title>
        <style type="text/css">
            .txtColor{
                color: green; 
            }


            .cl{
                font-size: 12px !important;
            }

        </style>
    </h:head>
    <h:body styleClass="cl">
        <p:panel style="margin: 10px; margin-top: 25px">
            <h:form id="forma">     
                <p:growl id="notify" showDetail="true" sticky="false"/>
                <p:messages id="notificaciones"/>
                <h:panelGrid id="grid" columns="4" cellspacing="5">
                    <p:outputLabel style="margin-right: 20px; " value="Matrícula :"  styleClass="cl" />
                    <p:inputText id="mat" value="#{pres.matricula}" required="true"  requiredMessage="Insertar matrícula" style="height: 20px; width: 150px;" styleClass="cl">
                        <f:validateRegex pattern="[0-9]+" />
                        <f:validateLength minimum="3" maximum="20" >
                        </f:validateLength> 

                    </p:inputText>

                    <p:commandButton id="find" value="Verificar" style="border-radius: 5px; height: 30px; width: 150px;" action="#{pres.findPres}" styleClass="cl" 
                                     update="presName,carrera,mail,tel,notify,log,@this"   disabled="#{pres.us ne null}"/>   

                    <p:commandLink id="log" value="Cerrar sesión" action="#{pres.logOut}" update="mat,presName,carrera,mail,tel,@this,find" disabled="#{pres.us eq null}" styleClass="cl" />

                </h:panelGrid>

                <h:panelGrid id="pan2" columns="4" cellspacing="5" cellpadding="5px">

                    <p:outputLabel value="Nombre: " for="presName" styleClass="cl"/> <p:inputText value="#{pres.nombre}" id="presName" size="30" disabled="true" styleClass="cl"/>
                    <p:outputLabel value="Carrera: " for="carrera" styleClass="cl" /> <p:inputText value="#{pres.carrera}" id="carrera" size="10" disabled="true" styleClass="cl"/>

                    <p:outputLabel value="Correo: " for="mail" styleClass="cl"/> <p:inputText value="#{pres.correo}" id="mail" size="10" disabled="true"/>
                    <p:outputLabel value="Teléfono: " for="tel" styleClass="cl"/> <p:inputText value="#{pres.telefono}" id="tel" size="10" disabled="true" styleClass="cl"/>

                </h:panelGrid>

                <p:tabView id="tabView" style="margin-top: 10px;" >  

                    <p:ajax event="tabChange" listener="#{pres.onTabChange}" />

                    <p:tab id="sol" title="Solicitudes">
                        <p:dataTable id="soles" value="#{pres.listSol}" var="sl" rows="6" paginator="true"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15">

                            <p:ajax event="rowToggle" listener="#{pres.onRowToggle}"  />  
                            <p:column style="width:2%">  
                                <p:rowToggler  />  
                            </p:column>  

                            <p:column style="width:10%">  
                                <f:facet name="header">  
                                    No. Prestamo  
                                </f:facet>  
                                <h:outputText value="#{sl.idPrestamo}" />  
                            </p:column>  

                            <p:column style="width:22%">  
                                <f:facet name="header">  
                                    Fecha de solicitud  
                                </f:facet>  
                                <h:outputText value="#{sl.fechaSolicitud}" />  
                            </p:column>  





                            <p:column style="width:22%">  
                                <f:facet name="header">  
                                    Estatus del prestamo
                                </f:facet>  
                                <h:outputText id="estatus" value="#{sl.statusprestamo}" />  
                            </p:column>  

                            <p:column style="width:22%">  
                                <f:facet name="header">  
                                    Fecha vencimiento
                                </f:facet>  
                                <p:calendar id="datetime" value="#{sl.date10}" showOn="button" pattern="MM/dd/yyyy HH:mm:ss"  >
                                    <f:attribute name="prestamito" value="#{sl}"/>
                                    <p:ajax event="dateSelect" listener="#{pres.dateListener}" />
                                </p:calendar>

                            </p:column>  

                            <p:rowExpansion>  
                                <p:growl id="noti" showDetail="true" sticky="false"/>
                                <p:dataTable id="dtls"   value="#{sl.tblDetalleprestamoList}" var="hl" editable="true"
                                             >
                                    <p:ajax event="rowEdit" listener="#{pres.onRowEdit}">

                                    </p:ajax>
                                    <p:ajax event="rowEditCancel" listener="#{pres.onRowCancel}"  />


                                    <p:column >  
                                        <f:facet name="header">  
                                            ID
                                        </f:facet>  
                                        <h:outputText value="#{hl.idDetalleprestamo}" />  
                                    </p:column>  

                                    <p:column >  
                                        <f:facet name="header" >  
                                            No. Parte
                                        </f:facet>  

                                        <p:commandLink  value="No. Parte" action="#{pres.listenPartNumber()}">
                                            <f:setPropertyActionListener value="#{hl}" target="#{pres.showInfo}"/>
                                        </p:commandLink>


                                    </p:column>  

                                    <p:column >  
                                        <f:facet name="header">  
                                            Nombre
                                        </f:facet>  
                                        <h:outputText value="#{hl.nombre}" />  
                                    </p:column>  



                                    <p:column >  
                                        <f:facet name="header">  
                                            Cantidad solicitada
                                        </f:facet>  
                                        <p:cellEditor>  
                                            <f:facet name="output"><h:outputText value="#{hl.cantidad}" /></f:facet>  
                                            <f:facet name="input">
                                                <p:inputText id="modelInput" value="#{hl.cantidad}" style="width:96%" validator="inspector" >
                                                    <f:attribute name="obj" value="#{hl}"/>
                                                </p:inputText>
                                            </f:facet>  
                                        </p:cellEditor>  
                                    </p:column>  
                                    <p:column style="width:32px">
                                        <p:rowEditor />
                                    </p:column>
                                    <p:column >
                                        <p:selectBooleanCheckbox valueChangeListener="#{pres.checkBox}">
                                            <f:attribute name="obj" value="#{hl}"/>
                                            <p:ajax/>
                                        </p:selectBooleanCheckbox>
                                    </p:column> 

                                </p:dataTable>

                                <h:panelGrid columns="2" cellpadding="5px" cellspacing="5px" style="border: 0px none; margin-top: 10px"> 
                                    <p:commandButton value="Deshacer" action="#{pres.resetListener}" update="dtls">
                                        <f:setPropertyActionListener value="#{sl.tblDetalleprestamoList}" target="#{pres.dtls}"/>
                                    </p:commandButton>
                                    <p:commandButton value="Guardar" action="#{pres.saveSelected}" update="noti" disabled="#{pres.activo eq 2}">
                                        <f:setPropertyActionListener value="#{sl}" target="#{pres.currentPres}"/>

                                    </p:commandButton>
                                </h:panelGrid>

                            </p:rowExpansion>  
                        </p:dataTable>
                    </p:tab>

                    <p:tab id="tab1" title="Adeudos"> 

                        <p:dataTable id="debts" value="#{pres.listLoans}" var="pl" rows="6" paginator="true"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15">

                            <p:ajax event="rowToggle" listener="#{pres.onRowToggle}"  />  
                            <p:column style="width:2%">  
                                <p:rowToggler  />  
                            </p:column>  

                            <p:column style="width:15%">  
                                <f:facet name="header">  
                                    No. Prestamo  
                                </f:facet>  
                                <h:outputText value="#{pl.idPrestamo}" />  
                            </p:column>  

                            <p:column style="width:20%">  
                                <f:facet name="header">  
                                    Fecha de aprobación  
                                </f:facet>  
                                <h:outputText value="#{pl.fechaprestamo}" />  
                            </p:column>  

                            <p:column style="width:20%">  
                                <f:facet name="header">  
                                    Fecha vencimiento
                                </f:facet>  
                                <h:outputText value="#{pl.fechaVencimiento}" />  
                            </p:column>  

                            <p:column style="width:20%">  
                                <f:facet name="header">  
                                    Usuario  
                                </f:facet>  
                                <p:commandLink value="#{pl.idUsuarios}" action="#{pres.showUser}" >
                                    <f:setPropertyActionListener value="#{pl.idUsuarios}" target="#{pres.idUsuario}"/>
                                </p:commandLink>  
                            </p:column>  

                            <p:column style="width:20%">  
                                <f:facet name="header">  
                                    Estatus prestamo
                                </f:facet>  
                                <h:outputText id="estatus" value="#{pl.statusprestamo}" />  
                            </p:column>  

                            <p:rowExpansion>  
                                <p:growl id="noti" showDetail="true" sticky="false"/>
                                <p:dataTable id="dtls"   value="#{pl.tblDetalleprestamoList}" var="dl" editable="true" >
                                    <p:ajax event="rowEdit" listener="#{pres.onRowEdit}" update="fr,hr">

                                    </p:ajax>
                                    <p:ajax event="rowEditCancel" listener="#{pres.onRowCancel}"  />

                                    <p:column style="width:49%">  
                                        <f:facet name="header" >  
                                            No. Parte
                                        </f:facet>  

                                        <p:commandLink  value="No. Parte" action="#{pres.listenPartNumber()}">
                                            <f:setPropertyActionListener value="#{dl}" target="#{pres.showInfo}"/>
                                        </p:commandLink>


                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Nombre
                                        </f:facet>  
                                        <h:outputText value="#{dl.nombre}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Cantidad prestada
                                        </f:facet>  
                                        <h:outputText value="#{dl.cantidad}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Cantidad entregada
                                        </f:facet>  
                                        <p:cellEditor>  
                                            <f:facet name="output"><h:outputText value="#{dl.regresados}" /></f:facet>  
                                            <f:facet name="input">
                                                <p:inputText id="modelInput" value="#{dl.regresados}" style="width:96%" validator="cantidad" >
                                                    <f:attribute name="valor" value="#{dl.cantidad}"/>

                                                </p:inputText>
                                            </f:facet>  
                                        </p:cellEditor>  
                                    </p:column>  
                                    <p:column style="width:32px">
                                        <p:rowEditor />
                                    </p:column>
                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Fecha retorno
                                        </f:facet>  
                                        <h:outputText id="fr" value="#{dl.fecharetorno}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Hora retorno
                                        </f:facet>  
                                        <h:outputText id="hr"  value="#{dl.horaretorno}" />  
                                    </p:column>  


                                </p:dataTable>

                                <h:panelGrid columns="2" cellpadding="5px" cellspacing="5px" style="border: 0px none; margin-top: 10px"> 
                                    <p:commandButton value="Deshacer" action="#{pres.resetListener}" update="dtls">
                                        <f:setPropertyActionListener value="#{pl.tblDetalleprestamoList}" target="#{pres.dtls}"/>
                                    </p:commandButton>
                                    <p:commandButton value="Guardar" action="#{pres.savePres}" update="noti">
                                        <f:setPropertyActionListener value="#{pl}" target="#{pres.currentPres}"/>
                                    </p:commandButton>
                                </h:panelGrid>

                            </p:rowExpansion>  
                        </p:dataTable>

                    </p:tab>  

                    <p:tab id="tab2" title="Liberados">  



                        <p:dataTable id="freed" value="#{pres.freeds}" var="pf"  paginator="true" rows="6"
                                     paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,15">

                            <p:ajax event="rowToggle" listener="#{pres.onRowToggle}"  />  
                            <p:column style="width:2%">  
                                <p:rowToggler  />  
                            </p:column>  

                            <p:column style="width:49%">  
                                <f:facet name="header">  
                                    No. Prestamo  
                                </f:facet>  
                                <h:outputText value="#{pf.idPrestamo}" />  
                            </p:column>  

                            <p:column style="width:49%">  
                                <f:facet name="header">  
                                    Fecha aprobación  
                                </f:facet>  
                                <h:outputText value="#{pf.fechaprestamo}" />  
                            </p:column>  

                            <p:column style="width:49%">  
                                <f:facet name="header">  
                                    Hora aprobación  
                                </f:facet>  
                                <h:outputText value="#{pf.horaprestamo}" />  
                            </p:column>  

                            <p:column style="width:49%">  
                                <f:facet name="header">  
                                    Usuario  
                                </f:facet>  
                                <p:commandLink value="#{pf.idUsuarios}" action="#{pres.showUser()}" >
                                    <f:setPropertyActionListener value="#{pf.idUsuarios}" target="#{pres.idUsuario}"/>
                                </p:commandLink>   
                            </p:column>  

                            <p:column style="width:49%">  
                                <f:facet name="header">  
                                    Fecha retorno
                                </f:facet>  
                                <h:outputText id="estatus" value="#{pf.fecharetorno}" />  
                            </p:column>  

                            <p:rowExpansion>  

                                <p:dataTable id="dtls"   value="#{pf.tblDetalleprestamoList}" var="ld" >

                                    <p:column style="width:49%">  
                                        <f:facet name="header" >  
                                            No. Parte
                                        </f:facet>  

                                        <p:commandLink value="No. Parte" action="#{pres.listenPartNumber()}">
                                            <f:setPropertyActionListener value="#{ld}" target="#{pres.showInfo}"/>
                                        </p:commandLink>


                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Nombre
                                        </f:facet>  
                                        <h:outputText value="#{ld.nombre}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Cantidad
                                        </f:facet>  
                                        <h:outputText value="#{ld.cantidad}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Fecha retorno
                                        </f:facet>  
                                        <h:outputText id="fr" value="#{ld.fecharetorno}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  
                                        <f:facet name="header">  
                                            Hora retorno
                                        </f:facet>  
                                        <h:outputText id="hr"  value="#{ld.horaretorno}" />  
                                    </p:column>  

                                    <p:column style="width:49%">  



                                    </p:column>  
                                </p:dataTable>

                            </p:rowExpansion>  
                        </p:dataTable>




                    </p:tab>  

                </p:tabView>  


            </h:form>
        </p:panel>
    </h:body>
</html>

