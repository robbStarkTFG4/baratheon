<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>

        <title>historial prestamos</title>
        <style type="text/css">
            .txtColor{
                color: green; 
            }
        </style>
    </h:head>
    <h:body>
        <h:form id="forma">     
            <p:growl id="notify" showDetail="true" sticky="false"/>
            <h:panelGrid id="grid" columns="4">
                <p:outputLabel style="margin-right: 20px" value="Matricula :" />
                <p:inputText id="mat" value="#{pres.matricula}" required="true"  requiredMessage="Inserta matricula" style="height: 20px; width: 150px;">
                    <f:validateRegex pattern="[0-9]+" />
                    <f:validateLength minimum="3" maximum="20" >
                    </f:validateLength> 
                    <f:ajax render="mensajenom" event="keyup"/>
                </p:inputText>
                <p:message id="mensajenom"  for="mat" />                     
                <p:commandButton value="Verificar" style="border-radius: 5px; height: 30px; width: 150px;" action="#{pres.findPres}" 
                                 update="presName,carrera,mail,tel,notify"/>                   

            </h:panelGrid>
            <h:panelGrid columns="4" cellspacing="5" cellpadding="5px">

                <p:outputLabel value="nombre: " for="presName"/> <p:inputText value="#{pres.nombre}" id="presName" size="30" disabled="true"/>
                <p:outputLabel value="carrera: " for="carrera"/> <p:inputText value="#{pres.carrera}" id="carrera" size="10" disabled="true"/>

                <p:outputLabel value="correo: " for="mail"/> <p:inputText value="#{pres.correo}" id="mail" size="10" disabled="true"/>
                <p:outputLabel value="telefono: " for="tel"/> <p:inputText value="#{pres.telefono}" id="tel" size="10" disabled="true"/>

            </h:panelGrid>

            <p:tabView id="tabView" style="margin-top: 10px;" >  
                 
                  <p:ajax event="tabChange" listener="#{pres.onTabChange}" />
                
                <p:tab id="tab1" title="adeudos"> 

                    <p:dataTable id="debts" value="#{pres.listLoans}" var="pl">

                        <p:ajax event="rowToggle" listener="#{pres.onRowToggle}"  />  
                        <p:column style="width:2%">  
                            <p:rowToggler  />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                #prestamo  
                            </f:facet>  
                            <h:outputText value="#{pl.idPrestamo}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                fecha prestamo  
                            </f:facet>  
                            <h:outputText value="#{pl.fechaprestamo}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                hora prestamo  
                            </f:facet>  
                            <h:outputText value="#{pl.horaprestamo}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                usuario  
                            </f:facet>  
                            <p:commandLink value="#{pl.idUsuarios}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                estatus prestamo
                            </f:facet>  
                            <h:outputText id="estatus" value="#{pl.statusprestamo}" />  
                        </p:column>  

                        <p:rowExpansion>  
                            <p:growl id="noti" showDetail="true" sticky="false"/>
                            <p:dataTable id="dtls"   value="#{pl.tblDetalleprestamoList}" var="dl" >

                                <p:column style="width:49%">  
                                    <f:facet name="header" >  
                                        #parte
                                    </f:facet>  

                                    <p:commandLink value="#parte" action="#{pres.listenPartNumber()}"/>


                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        nombre
                                    </f:facet>  
                                    <h:outputText value="#{dl.nombre}" />  
                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        cantidad
                                    </f:facet>  
                                    <h:outputText value="#{dl.cantidad}" />  
                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        fecha retorno
                                    </f:facet>  
                                    <h:outputText id="fr" value="#{dl.fecharetorno}" />  
                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        hora retorno
                                    </f:facet>  
                                    <h:outputText id="hr"  value="#{dl.horaretorno}" />  
                                </p:column>  

                                <p:column style="width:49%">  


                                    <p:commandButton value="entregar" action="#{pres.checkDtl}" update="fr,hr" >
                                        <f:setPropertyActionListener value="#{dl}" target="#{pres.currentDtl}"/>
                                    </p:commandButton>  
                                </p:column>  
                            </p:dataTable>

                            <h:panelGrid columns="2" cellpadding="5px" cellspacing="5px" style="border: 0px none; margin-top: 10px"> 
                                <p:commandButton value="deshacer" action="#{pres.resetListener}" update="dtls">
                                    <f:setPropertyActionListener value="#{pl.tblDetalleprestamoList}" target="#{pres.dtls}"/>
                                </p:commandButton>
                                <p:commandButton value="Guardar" action="#{pres.savePres}" update="noti">
                                    <f:setPropertyActionListener value="#{pl}" target="#{pres.currentPres}"/>
                                </p:commandButton>
                            </h:panelGrid>

                        </p:rowExpansion>  
                    </p:dataTable>

                </p:tab>  

                <p:tab id="tab2" title="liberados">  



                    <p:dataTable id="freed" value="#{pres.freeds}" var="pf">

                        <p:ajax event="rowToggle" listener="#{pres.onRowToggle}"  />  
                        <p:column style="width:2%">  
                            <p:rowToggler  />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                #prestamo  
                            </f:facet>  
                            <h:outputText value="#{pf.idPrestamo}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                fecha prestamo  
                            </f:facet>  
                            <h:outputText value="#{pf.fechaprestamo}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                hora prestamo  
                            </f:facet>  
                            <h:outputText value="#{pf.horaprestamo}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                usuario  
                            </f:facet>  
                            <p:commandLink value="#{pf.idUsuarios}" />  
                        </p:column>  

                        <p:column style="width:49%">  
                            <f:facet name="header">  
                                fecha retorno
                            </f:facet>  
                            <h:outputText id="estatus" value="#{pf.fecharetorno}" />  
                        </p:column>  

                        <p:rowExpansion>  
                           
                            <p:dataTable id="dtls"   value="#{pf.tblDetalleprestamoList}" var="ld" >

                                <p:column style="width:49%">  
                                    <f:facet name="header" >  
                                        #parte
                                    </f:facet>  

                                    <p:commandLink value="#parte" action="#{pres.listenPartNumber()}"/>


                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        nombre
                                    </f:facet>  
                                    <h:outputText value="#{ld.nombre}" />  
                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        cantidad
                                    </f:facet>  
                                    <h:outputText value="#{ld.cantidad}" />  
                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        fecha retorno
                                    </f:facet>  
                                    <h:outputText id="fr" value="#{ld.fecharetorno}" />  
                                </p:column>  

                                <p:column style="width:49%">  
                                    <f:facet name="header">  
                                        hora retorno
                                    </f:facet>  
                                    <h:outputText id="hr"  value="#{ld.horaretorno}" />  
                                </p:column>  

                                <p:column style="width:49%">  



                                </p:column>  
                            </p:dataTable>

                        </p:rowExpansion>  
                    </p:dataTable>




                </p:tab>  

            </p:tabView>  


        </h:form>
    </h:body>
</html>

